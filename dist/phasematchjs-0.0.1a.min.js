(function(t,e){"object"==typeof exports?module.exports=e(require("numeric")):"function"==typeof define&&define.amd?define(["numeric"],e):t.PhaseMatch=e(t.numeric)})(this,function(){"use strict";function t(t){return t*t}var e={util:{}};(function(t,e){function n(){}function r(t,e,n,r){function a(){var r=arguments,u=s?this:e;if(o||(t=e[c]),n.length&&(r=r.length?(r=q.call(r),h?r.concat(n):n.concat(r)):n),this instanceof a){i.prototype=t.prototype,u=new i,i.prototype=null;var p=t.apply(u,r);return l(p)?p:u}return t.apply(u,r)}var o=u(t),s=!n,c=e;if(s){var h=r;n=e}else if(!o){if(!r)throw new TypeError;e=t}return a}function a(){for(var t,e={shadowedProps:b,arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!R},r=0;t=arguments[r];r++)for(var a in t)e[a]=t[a];var o=e.args;e.firstArg=/^[^,]+/.exec(o)[0];var i=Function("hasOwnProperty, isArguments, isArray, keys, lodash, objectTypes","return function("+o+") {\n"+G(e)+"\n}");return i(E,s,N,R,n,I)}function o(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function i(){}function s(t){return T.call(t)==y}function c(t,e,r,a,i,l){var h=r===g;if("function"==typeof r&&!h){r=n.createCallback(r,a,2);var p=r(t,e);if(p!==undefined)return!!p}if(t===e)return 0!==t||1/t==1/e;var f=typeof t,d=typeof e;if(t===t&&(!t||"function"!=f&&"object"!=f)&&(!e||"function"!=d&&"object"!=d))return!1;if(null==t||null==e)return t===e;var b=T.call(t),w=T.call(e);if(b==y&&(b=_),w==y&&(w=_),b!=w)return!1;switch(b){case m:case v:return+t==+e;case x:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case P:case j:return t==e+""}var I=b==M;if(!I){if(E.call(t,"__wrapped__ ")||E.call(e,"__wrapped__"))return c(t.__wrapped__||t,e.__wrapped__||e,r,a,i,l);if(b!=_||!H.nodeClass&&(o(t)||o(e)))return!1;var O=!H.argsObject&&s(t)?Object:t.constructor,k=!H.argsObject&&s(e)?Object:e.constructor;if(O!=k&&!(u(O)&&O instanceof O&&u(k)&&k instanceof k))return!1}i||(i=[]),l||(l=[]);for(var A=i.length;A--;)if(i[A]==t)return l[A]==e;var C=0;if(p=!0,i.push(t),l.push(e),I){if(A=t.length,C=e.length,p=C==t.length,!p&&!h)return p;for(;C--;){var L=A,S=e[C];if(h)for(;L--&&!(p=c(t[L],S,r,a,i,l)););else if(!(p=c(t[C],S,r,a,i,l)))break}return p}return J(e,function(e,n,o){return E.call(o,n)?(C++,p=E.call(t,n)&&c(t[n],e,r,a,i,l)):undefined}),p&&!h&&J(t,function(t,e,n){return E.call(n,e)?p=--C>-1:undefined}),p}function u(t){return"function"==typeof t}function l(t){return t?I[typeof t]:!1}function h(t,e){return H.fastBind||C&&arguments.length>2?C.call.apply(C,arguments):r(t,e,q.call(arguments,2))}function p(t,e,n){if(null==t)return f;var r=typeof t;if("function"!=r){if("object"!=r)return function(e){return e[t]};var a=R(t);return function(e){for(var n=a.length,r=!1;n--&&(r=c(e[a[n]],t[a[n]],g)););return r}}return e!==undefined?1===n?function(n){return t.call(e,n)}:2===n?function(n,r){return t.call(e,n,r)}:4===n?function(n,r,a,o){return t.call(e,n,r,a,o)}:function(n,r,a){return t.call(e,n,r,a)}:t}function f(t){return t}var d="object"==typeof global&&global;(d.global===d||d.window===d)&&(t=d);var g={};+new Date+"";var b=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],y="[object Arguments]",M="[object Array]",m="[object Boolean]",v="[object Date]",w="[object Function]",x="[object Number]",_="[object Object]",P="[object RegExp]",j="[object String]",I={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},O=[],k={};t._;var A=RegExp("^"+(k.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),E=(Math.ceil,t.clearTimeout,O.concat,Math.floor,k.hasOwnProperty),T=(O.push,t.setTimeout,k.toString),C=A.test(C=T.bind)&&C,L=A.test(L=Array.isArray)&&L,S=(t.isFinite,t.isNaN,A.test(S=Object.keys)&&S),q=(Math.max,Math.min,Math.random,O.slice),F=A.test(t.attachEvent),B=C&&!/\n|true/.test(C+F),H=n.support={};(function(){var t=function(){this.x=1},e=[];t.prototype={valueOf:1,y:1};for(var n in new t)e.push(n);for(n in arguments);H.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),H.argsClass=s(arguments),H.enumPrototypes=t.propertyIsEnumerable("prototype"),H.fastBind=C&&!B,H.nonEnumArgs=0!=n,H.nonEnumShadows=!/valueOf/.test(e),H.unindexedChars="xx"!="x"[0]+Object("x")[0];try{H.nodeClass=!(T.call(document)==_&&!({toString:0}+""))}catch(r){H.nodeClass=!0}})(1);var G=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";\n";if(t.arrays?(e+="var length = iterable.length; index = -1;\nif ("+t.arrays+") {  ",H.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+"\n  }\n}\nelse {  "):H.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+"\n    }\n  } else {  "),H.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    ",H.enumPrototypes&&(e+="if (!(skipProto && index == 'prototype')) {\n  "),e+=t.loop,H.enumPrototypes&&(e+="}\n"),e+="  }  ";else if(e+="\n  for (index in iterable) {",(H.enumPrototypes||t.useHas)&&(e+="\n    if (",H.enumPrototypes&&(e+="!(skipProto && index == 'prototype')"),H.enumPrototypes&&t.useHas&&(e+=" && "),t.useHas&&(e+="hasOwnProperty.call(iterable, index)"),e+=") {    "),e+=t.loop+";    ",(H.enumPrototypes||t.useHas)&&(e+="\n    }"),e+="\n  }    ",H.nonEnumShadows){e+="\n\n  var ctor = iterable.constructor;\n      ";for(var n=0;7>n;n++)e+="\n  index = '"+t.shadowedProps[n]+"';\n  if (","constructor"==t.shadowedProps[n]&&(e+="!(ctor && ctor.prototype === iterable) && "),e+="hasOwnProperty.call(iterable, index)) {\n    "+t.loop+"\n  }      "}return(t.arrays||H.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},D={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},z={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},K={top:"if (!objectTypes[typeof iterable]) return result;\n"+z.top,arrays:!1};H.argsClass||(s=function(t){return t?E.call(t,"callee"):!1});var N=L||function(t){return t?"object"==typeof t&&T.call(t)==M:!1},W=a({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),R=S?function(t){return l(t)?H.enumPrototypes&&"function"==typeof t||H.nonEnumArgs&&t.length&&s(t)?W(t):S(t):[]}:W,$=a(D,{top:D.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),J=a(z,K,{useHas:!1}),V=a(z,K);u(/x/)&&(u=function(t){return"function"==typeof t&&T.call(t)==w}),n.assign=$,n.bind=h,n.createCallback=p,n.forIn=J,n.forOwn=V,n.keys=R,n.extend=$,n.identity=f,n.isArguments=s,n.isArray=N,n.isEqual=c,n.isFunction=u,n.isObject=l,n.VERSION="1.2.1",n.extend(e.util,n)})(this,e);var n=Math.pow(10,-9),r=Math.pow(10,-6),a=2.99792458*Math.pow(10,8);return e.constants={um:r,nm:n,c:a},e.BBO=function(t){this.temp=t},e.BBO.prototype={indicies:function(e){e*=Math.pow(10,6);var n=Math.sqrt(2.7359+.01878/(t(e)-.01822)-.01354*t(e)),r=Math.sqrt(2.3753+.01224/(t(e)-.01667)-.01516*t(e));return[n,n,r]}},e.GetIndices=function(e,n,r,a,o,i){var s=Math.sin(o)*Math.cos(i),c=Math.sin(o)*Math.sin(i),u=Math.cos(o),l=Math.cos(r)*Math.cos(a)*s-Math.sin(a)*c+Math.sin(r)*Math.cos(a)*u,h=Math.cos(r)*Math.sin(a)*s+Math.cos(a)*c+Math.sin(r)*Math.sin(a)*u,p=-Math.sin(r)*s+Math.cos(r)*u,f=Math.sqrt(t(s)+t(c)+t(u)),d=l/f,g=h/f,b=p/f,y=e.indicies(n),M=y[0],m=y[1],v=y[2],w=t(d)*(1/t(m)+1/t(v))+t(g)*(1/t(M)+1/t(v))+t(b)*(1/t(M)+1/t(m)),x=t(d)/(t(m)*t(v))+t(g)/(t(M)*t(v))+t(b)/(t(M)*t(m)),_=t(w)-4*x,P=Math.sqrt(2/(w+Math.sqrt(_))),j=Math.sqrt(2/(w-Math.sqrt(_)));return[j,P]},e.GetPMTypeIndices=function(t,n,r,a,o,i,s,c,u,l,h){var p,f,d,g=e.GetIndices(t,a,i,s,c,l),b=e.GetIndices(t,o,i,s,u,h),y=e.GetIndices(t,r,i,s,0,0);switch(n){case"e -> o + o":p=g[0],f=b[0],d=y[1];break;case"e -> e + o":p=g[1],f=b[0],d=y[1];break;case"e -> o + e":p=g[0],f=b[1],d=y[1];break;default:throw"Error: bad PMType specified"}return[p,f,d]},e.spdc_to_pump_coordinates=function(t,e){return[Math.sin(t)*Math.cos(e),Math.sin(t)*Math.sin(e),Math.cos(t)]},e.calc_delK=function(t,n,r,a,o,i,s,c,u,l,h,p){var f=e.GetPMTypeIndices(t,n,r,a,o,i,s,c,u,l,h),d=f[0],g=f[1],b=f[2],y=[Math.sin(c)*Math.cos(l),Math.sin(c)*Math.sin(l),Math.cos(c)],M=[Math.sin(u)*Math.cos(h),Math.sin(u)*Math.sin(h),Math.cos(u)],m=2*Math.PI*(d*y[0]/a+g*M[0]/o),v=2*Math.PI*(d*y[1]/a+g*M[1]/o),w=2*Math.PI*(b/r-d*y[2]/a-g*M[2]/o);return w-=2*Math.PI/p,[m,v,w]},e.optimum_idler=function(n,r,a,o,i,s,c,u,l){var h=1/(1/a-1/o),p=s+Math.PI,f=o/l,d=e.GetPMTypeIndices(n,r,a,o,h,c,u,i,i,s,p),g=d[0];d[1];var b=d[2],y=t(g)+t(b*o/a);y-=2*g*b*(o/a)*Math.cos(i)-2*b*o/a*f,y+=2*g*Math.cos(i)*f+t(f),y=Math.sqrt(y);var M=g*Math.sin(i)/y,m=Math.asin(M);return m},e.phasematch=function(n,r,a,o,i,s,c,u,l,h,p,f,d,g,b){var y=1/(1/s+1/c),M=e.calc_delK(n,r,y,s,c,l,h,p,f,d,g,b),m=u/2*M[2],v=Math.sin(m)/m,w=v*Math.cos(m),x=v*Math.sin(m),_=Math.exp(-.5*(t(M[0])+t(M[1]))*t(i)),P=1;return[P*_*w,P*_*x]},e.phasematch_Int_Phase=function(n,r,a,o,i,s,c,u,l,h,p,f,d,g,b,y,M,m){var v=e.phasematch(n,r,a,o,i,s,c,u,l,h,p,f,d,g,b,y,M,m);return y?Math.atan2(v[1],v[0])+Math.PI:v=t(v[0])+t(v[1]),v},function(){var t=function(t){this.init(t)};t.prototype={init:function(){var t=e.constants;this.lambda_p=775*t.nm,this.lambda_s=1500*t.nm,this.lambda_i=1600*t.nm,this.Type=["o -> o + o","e -> o + o","e -> e + o","e -> o + e"],this.theta=19.8371104525*Math.PI/180,this.phi=0,this.theta_s=0,this.theta_i=0,this.phi_s=0,this.phi_i=0,this.poling_period=1e6,this.L=2e4*t.um,this.W=500*t.um,this.p_bw=1,this.phase=!1,this.apodization=1,this.apodization_FWHM=1e3*t.um,this.xtal=new e.BBO}},e.SPDCprop=t}(),e.calcJSA=function(t,n,r,a,o,i){var s,c=new Float64Array(i),u=new Float64Array(i);c=e.linspace(n,r,i),u=e.linspace(o,a,i);var l=new Float64Array(i*i),h=i*i;for(new Date,s=0;h>s;s++){var p=s%i,f=Math.floor(s/i);l[s]=e.phasematch_Int_Phase(t.xtal,t.Type[1],t.lambda_p,t.p_bw,t.W,c[p],u[f],t.L,t.theta,t.phi,t.theta_s,t.theta_i,t.phi_s,t.phi_i,t.poling_period,t.phase,t.apodization,t.apodization_FWHM)}return new Date,l},e.linspace=function(t,e,n){for(var r=(e-t)/n,a=new Float64Array(n),o=0;n>o;o++)a[o]=t+r*o;return a},e});