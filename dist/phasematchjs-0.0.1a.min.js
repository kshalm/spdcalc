(function(t,a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):t.PhaseMatch=a()})(this,function(){"use strict";var t={},a=Math.pow(10,-9),h=Math.pow(10,-6),o=2.99792458*Math.pow(10,8);return t.constants={um:h,nm:a,c:o},t.BBO=function(t){this.temp=t},t.BBO.prototype={indicies:function(t){t*=Math.pow(10,6);var a=Math.sqrt(2.7359+.01878/(Math.pow(t,2)-.01822)-.01354*Math.pow(t,2)),h=Math.sqrt(2.3753+.01224/(Math.pow(t,2)-.01667)-.01516*Math.pow(t,2));return[a,a,h]}},t.GetIndices=function(t,a,h,o,i,n){var s=Math.sin(i)*Math.cos(n),e=Math.sin(i)*Math.sin(n),M=Math.cos(i),p=Math.cos(h)*Math.cos(o)*s-Math.sin(o)*e+Math.sin(h)*Math.cos(o)*M,r=Math.cos(h)*Math.sin(o)*s+Math.cos(o)*e+Math.sin(h)*Math.sin(o)*M,c=-Math.sin(h)*s+Math.cos(h)*M,w=Math.sqrt(Math.pow(s,2)+Math.pow(e,2)+Math.pow(M,2)),u=p/w,d=r/w,_=c/w,f=t.indicies(a),l=f[0],m=f[1],v=f[2],I=Math.pow(u,2)*(1/Math.pow(m,2)+1/Math.pow(v,2))+Math.pow(d,2)*(1/Math.pow(l,2)+1/Math.pow(v,2))+Math.pow(_,2)*(1/Math.pow(l,2)+1/Math.pow(m,2)),P=Math.pow(u,2)/(Math.pow(m,2)*Math.pow(v,2))+Math.pow(d,2)/(Math.pow(l,2)*Math.pow(v,2))+Math.pow(_,2)/(Math.pow(l,2)*Math.pow(m,2)),y=Math.pow(I,2)-4*P,b=Math.sqrt(2/(I+Math.sqrt(y))),q=Math.sqrt(2/(I-Math.sqrt(y)));return[q,b]},t.GetPMTypeIndices=function(a,h,o,i,n,s,e,M,p,r,c){var w,u,d,_=t.GetIndices(a,i,s,e,M,r),f=t.GetIndices(a,n,s,e,p,c),l=t.GetIndices(a,o,s,e,0,0);switch(h){case"e -> o + o":w=_[0],u=f[0],d=l[1];break;case"e -> e + o":w=_[1],u=f[0],d=l[1];break;case"e -> o + e":w=_[0],u=f[1],d=l[1];break;default:throw"Error: bad PMType specified"}return[w,u,d]},t.spdc_to_pump_coordinates=function(t,a){return[Math.sin(t)*Math.cos(a),Math.sin(t)*Math.sin(a),Math.cos(t)]},t.calc_delK=function(a,h,o,i,n,s,e,M,p,r,c,w){var u=t.GetPMTypeIndices(a,h,o,i,n,s,e,M,p,r,c),d=u[0],_=u[1],f=u[2],l=[Math.sin(M)*Math.cos(r),Math.sin(M)*Math.sin(r),Math.cos(M)],m=[Math.sin(p)*Math.cos(c),Math.sin(p)*Math.sin(c),Math.cos(p)],v=2*Math.PI*(d*l[0]/i+_*m[0]/n),I=2*Math.PI*(d*l[1]/i+_*m[1]/n),P=2*Math.PI*(f/o-d*l[2]/i-_*m[2]/n);return P-=2*Math.PI/w,[v,I,P]},t.optimum_idler=function(a,h,o,i,n,s,e,M,p){var r=1/(1/o-1/i),c=s+Math.PI,w=i/p,u=t.GetPMTypeIndices(a,h,o,i,r,e,M,n,n,s,c),d=u[0];u[1];var _=u[2],f=Math.pow(d,2)+Math.pow(_*i/o,2);f-=2*d*_*(i/o)*Math.cos(n)-2*_*i/o*w,f+=2*d*Math.cos(n)*w+Math.pow(w,2),f=Math.sqrt(f);var l=d*Math.sin(n)/f,m=Math.asin(l);return m},t.phasematch=function(a,h,o,i,n,s,e,M,p,r,c,w,u,d,_){var f=1/(1/s+1/e),l=t.calc_delK(a,h,f,s,e,p,r,c,w,u,d,_),m=M/2*l[2],v=Math.sin(m)/m,I=v*Math.cos(m),P=v*Math.sin(m),y=Math.exp(-.5*(Math.pow(l[0],2)+Math.pow(l[1],2))*Math.pow(n,2)),b=1;return[b*y*I,b*y*P]},t.phasematch_Int_Phase=function(a,h,o,i,n,s,e,M,p,r,c,w,u,d,_,f,l,m){var v=t.phasematch(a,h,o,i,n,s,e,M,p,r,c,w,u,d,_,f,l,m);return f?Math.atan2(v[1],v[0])+Math.PI:v=Math.pow(v[0],2)+Math.pow(v[1],2),v},function(){var a=function(){this.init()};a.prototype={init:function(){var a=t.constants;this.lambda_p=775*a.nm,this.lambda_s=1500*a.nm,this.lambda_i=1600*a.nm,this.Type=["o -> o + o","e -> o + o","e -> e + o","e -> o + e"],this.theta=19.8371104525*Math.PI/180,this.phi=0,this.theta_s=0,this.theta_i=0,this.phi_s=0,this.phi_i=0,this.poling_period=1e6,this.L=2e4*a.um,this.W=500*a.um,this.p_bw=1,this.phase=!1,this.apodization=1,this.apodization_FWHM=1e3*a.um,this.xtal=new t.BBO}},t.SPDCprop=a}(),t.calcJSA=function(a,h,o,i,n,s){var e,M=new Float64Array(s),p=new Float64Array(s);M=t.linspace(h,o,s),p=t.linspace(n,i,s);var r=new Float64Array(s*s),c=s*s;for(new Date,e=0;c>e;e++){var w=e%s,u=Math.floor(e/s);r[e]=t.phasematch_Int_Phase(a.xtal,a.Type[1],a.lambda_p,a.p_bw,a.W,M[w],p[u],a.L,a.theta,a.phi,a.theta_s,a.theta_i,a.phi_s,a.phi_i,a.poling_period,a.phase,a.apodization,a.apodization_FWHM)}return new Date,r},t.linspace=function(t,a,h){for(var o=(a-t)/h,i=new Float64Array(h),n=0;h>n;n++)i[n]=t+o*n;return i},t});