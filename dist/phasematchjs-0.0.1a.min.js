(function(t,e){"object"==typeof exports?module.exports=e(require("numeric")):"function"==typeof define&&define.amd?define(["numeric"],e):t.PhaseMatch=e(t.numeric)})(this,function(){"use strict";function t(t){return t*t}var e={util:{}};(function(){function t(){}function n(t,e,n,r){function a(){var r=arguments,c=s?this:e;if(i||(t=e[l]),n.length&&(r=r.length?(r=S.call(r),h?r.concat(n):n.concat(r)):n),this instanceof a){o.prototype=t.prototype,c=new o,o.prototype=null;var p=t.apply(c,r);return u(p)?p:c}return t.apply(c,r)}var i=c(t),s=!n,l=e;if(s){var h=r;n=e}else if(!i){if(!r)throw new TypeError;e=t}return a}function r(){for(var e,n={shadowedProps:g,arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!W},r=0;e=arguments[r];r++)for(var a in e)n[a]=e[a];var o=n.args;n.firstArg=/^[^,]+/.exec(o)[0];var s=Function("hasOwnProperty, isArguments, isArray, keys, lodash, objectTypes","return function("+o+") {\n"+H(n)+"\n}");return s(A,i,K,W,t,j)}function a(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function o(){}function i(t){return E.call(t)==b}function s(e,n,r,o,u,l){var h=r===d;if("function"==typeof r&&!h){r=t.createCallback(r,o,2);var p=r(e,n);if(p!==undefined)return!!p}if(e===n)return 0!==e||1/e==1/n;var f=typeof e,g=typeof n;if(e===e&&(!e||"function"!=f&&"object"!=f)&&(!n||"function"!=g&&"object"!=g))return!1;if(null==e||null==n)return e===n;var w=E.call(e),j=E.call(n);if(w==b&&(w=x),j==b&&(j=x),w!=j)return!1;switch(w){case M:case m:return+e==+n;case v:return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case _:case P:return e==n+""}var I=w==y;if(!I){if(A.call(e,"__wrapped__ ")||A.call(n,"__wrapped__"))return s(e.__wrapped__||e,n.__wrapped__||n,r,o,u,l);if(w!=x||!B.nodeClass&&(a(e)||a(n)))return!1;var O=!B.argsObject&&i(e)?Object:e.constructor,k=!B.argsObject&&i(n)?Object:n.constructor;if(O!=k&&!(c(O)&&O instanceof O&&c(k)&&k instanceof k))return!1}u||(u=[]),l||(l=[]);for(var T=u.length;T--;)if(u[T]==e)return l[T]==n;var C=0;if(p=!0,u.push(e),l.push(n),I){if(T=e.length,C=n.length,p=C==e.length,!p&&!h)return p;for(;C--;){var L=T,S=n[C];if(h)for(;L--&&!(p=s(e[L],S,r,o,u,l)););else if(!(p=s(e[C],S,r,o,u,l)))break}return p}return $(n,function(t,n,a){return A.call(a,n)?(C++,p=A.call(e,n)&&s(e[n],t,r,o,u,l)):undefined}),p&&!h&&$(e,function(t,e,n){return A.call(n,e)?p=--C>-1:undefined}),p}function c(t){return"function"==typeof t}function u(t){return t?j[typeof t]:!1}function l(t,e){return B.fastBind||T&&arguments.length>2?T.call.apply(T,arguments):n(t,e,S.call(arguments,2))}function h(t,e,n){if(null==t)return p;var r=typeof t;if("function"!=r){if("object"!=r)return function(e){return e[t]};var a=W(t);return function(e){for(var n=a.length,r=!1;n--&&(r=s(e[a[n]],t[a[n]],d)););return r}}return e!==undefined?1===n?function(n){return t.call(e,n)}:2===n?function(n,r){return t.call(e,n,r)}:4===n?function(n,r,a,o){return t.call(e,n,r,a,o)}:function(n,r,a){return t.call(e,n,r,a)}:t}function p(t){return t}var f="object"==typeof global&&global;(f.global===f||f.window===f)&&(window=f);var d={};+new Date+"";var g=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],b="[object Arguments]",y="[object Array]",M="[object Boolean]",m="[object Date]",w="[object Function]",v="[object Number]",x="[object Object]",_="[object RegExp]",P="[object String]",j={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},I=[],O={};window._;var k=RegExp("^"+(O.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),A=(Math.ceil,window.clearTimeout,I.concat,Math.floor,O.hasOwnProperty),E=(I.push,window.setTimeout,O.toString),T=k.test(T=E.bind)&&T,C=k.test(C=Array.isArray)&&C,L=(window.isFinite,window.isNaN,k.test(L=Object.keys)&&L),S=(Math.max,Math.min,Math.random,I.slice),q=k.test(window.attachEvent),F=T&&!/\n|true/.test(T+q),B=t.support={};(function(){var t=function(){this.x=1},e=[];t.prototype={valueOf:1,y:1};for(var n in new t)e.push(n);for(n in arguments);B.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),B.argsClass=i(arguments),B.enumPrototypes=t.propertyIsEnumerable("prototype"),B.fastBind=T&&!F,B.nonEnumArgs=0!=n,B.nonEnumShadows=!/valueOf/.test(e),B.unindexedChars="xx"!="x"[0]+Object("x")[0];try{B.nodeClass=!(E.call(document)==x&&!({toString:0}+""))}catch(r){B.nodeClass=!0}})(1);var H=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";\n";if(t.arrays?(e+="var length = iterable.length; index = -1;\nif ("+t.arrays+") {  ",B.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+"\n  }\n}\nelse {  "):B.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+"\n    }\n  } else {  "),B.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    ",B.enumPrototypes&&(e+="if (!(skipProto && index == 'prototype')) {\n  "),e+=t.loop,B.enumPrototypes&&(e+="}\n"),e+="  }  ";else if(e+="\n  for (index in iterable) {",(B.enumPrototypes||t.useHas)&&(e+="\n    if (",B.enumPrototypes&&(e+="!(skipProto && index == 'prototype')"),B.enumPrototypes&&t.useHas&&(e+=" && "),t.useHas&&(e+="hasOwnProperty.call(iterable, index)"),e+=") {    "),e+=t.loop+";    ",(B.enumPrototypes||t.useHas)&&(e+="\n    }"),e+="\n  }    ",B.nonEnumShadows){e+="\n\n  var ctor = iterable.constructor;\n      ";for(var n=0;7>n;n++)e+="\n  index = '"+t.shadowedProps[n]+"';\n  if (","constructor"==t.shadowedProps[n]&&(e+="!(ctor && ctor.prototype === iterable) && "),e+="hasOwnProperty.call(iterable, index)) {\n    "+t.loop+"\n  }      "}return(t.arrays||B.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},G={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},D={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},z={top:"if (!objectTypes[typeof iterable]) return result;\n"+D.top,arrays:!1};B.argsClass||(i=function(t){return t?A.call(t,"callee"):!1});var K=C||function(t){return t?"object"==typeof t&&E.call(t)==y:!1},N=r({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),W=L?function(t){return u(t)?B.enumPrototypes&&"function"==typeof t||B.nonEnumArgs&&t.length&&i(t)?N(t):L(t):[]}:N,R=r(G,{top:G.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),$=r(D,z,{useHas:!1}),J=r(D,z);c(/x/)&&(c=function(t){return"function"==typeof t&&E.call(t)==w}),t.assign=R,t.bind=l,t.createCallback=h,t.forIn=$,t.forOwn=J,t.keys=W,t.extend=R,t.identity=p,t.isArguments=i,t.isArray=K,t.isEqual=s,t.isFunction=c,t.isObject=u,t.VERSION="1.2.1",t.extend(e.util,t)})();var n=Math.pow(10,-9),r=Math.pow(10,-6),a=2.99792458*Math.pow(10,8);return e.constants={um:r,nm:n,c:a},e.BBO=function(t){this.temp=t},e.BBO.prototype={indicies:function(e){e*=Math.pow(10,6);var n=Math.sqrt(2.7359+.01878/(t(e)-.01822)-.01354*t(e)),r=Math.sqrt(2.3753+.01224/(t(e)-.01667)-.01516*t(e));return[n,n,r]}},e.GetIndices=function(e,n,r,a,o,i){var s=Math.sin(o)*Math.cos(i),c=Math.sin(o)*Math.sin(i),u=Math.cos(o),l=Math.cos(r)*Math.cos(a)*s-Math.sin(a)*c+Math.sin(r)*Math.cos(a)*u,h=Math.cos(r)*Math.sin(a)*s+Math.cos(a)*c+Math.sin(r)*Math.sin(a)*u,p=-Math.sin(r)*s+Math.cos(r)*u,f=Math.sqrt(t(s)+t(c)+t(u)),d=l/f,g=h/f,b=p/f,y=e.indicies(n),M=y[0],m=y[1],w=y[2],v=t(d)*(1/t(m)+1/t(w))+t(g)*(1/t(M)+1/t(w))+t(b)*(1/t(M)+1/t(m)),x=t(d)/(t(m)*t(w))+t(g)/(t(M)*t(w))+t(b)/(t(M)*t(m)),_=t(v)-4*x,P=Math.sqrt(2/(v+Math.sqrt(_))),j=Math.sqrt(2/(v-Math.sqrt(_)));return[j,P]},e.GetPMTypeIndices=function(t,n,r,a,o,i,s,c,u,l,h){var p,f,d,g=e.GetIndices(t,a,i,s,c,l),b=e.GetIndices(t,o,i,s,u,h),y=e.GetIndices(t,r,i,s,0,0);switch(n){case"e -> o + o":p=g[0],f=b[0],d=y[1];break;case"e -> e + o":p=g[1],f=b[0],d=y[1];break;case"e -> o + e":p=g[0],f=b[1],d=y[1];break;default:throw"Error: bad PMType specified"}return[p,f,d]},e.spdc_to_pump_coordinates=function(t,e){return[Math.sin(t)*Math.cos(e),Math.sin(t)*Math.sin(e),Math.cos(t)]},e.calc_delK=function(t,n,r,a,o,i,s,c,u,l,h,p){var f=e.GetPMTypeIndices(t,n,r,a,o,i,s,c,u,l,h),d=f[0],g=f[1],b=f[2],y=[Math.sin(c)*Math.cos(l),Math.sin(c)*Math.sin(l),Math.cos(c)],M=[Math.sin(u)*Math.cos(h),Math.sin(u)*Math.sin(h),Math.cos(u)],m=2*Math.PI*(d*y[0]/a+g*M[0]/o),w=2*Math.PI*(d*y[1]/a+g*M[1]/o),v=2*Math.PI*(b/r-d*y[2]/a-g*M[2]/o);return v-=2*Math.PI/p,[m,w,v]},e.optimum_idler=function(n,r,a,o,i,s,c,u,l){var h=1/(1/a-1/o),p=s+Math.PI,f=o/l,d=e.GetPMTypeIndices(n,r,a,o,h,c,u,i,i,s,p),g=d[0];d[1];var b=d[2],y=t(g)+t(b*o/a);y-=2*g*b*(o/a)*Math.cos(i)-2*b*o/a*f,y+=2*g*Math.cos(i)*f+t(f),y=Math.sqrt(y);var M=g*Math.sin(i)/y,m=Math.asin(M);return m},e.phasematch=function(n,r,a,o,i,s,c,u,l,h,p,f,d,g,b){var y=1/(1/s+1/c),M=e.calc_delK(n,r,y,s,c,l,h,p,f,d,g,b),m=u/2*M[2],w=Math.sin(m)/m,v=w*Math.cos(m),x=w*Math.sin(m),_=Math.exp(-.5*(t(M[0])+t(M[1]))*t(i)),P=1;return[P*_*v,P*_*x]},e.phasematch_Int_Phase=function(n,r,a,o,i,s,c,u,l,h,p,f,d,g,b,y,M,m){var w=e.phasematch(n,r,a,o,i,s,c,u,l,h,p,f,d,g,b,y,M,m);return y?Math.atan2(w[1],w[0])+Math.PI:w=t(w[0])+t(w[1]),w},function(){var t=function(t){this.init(t)};t.prototype={init:function(){var t=e.constants;this.lambda_p=775*t.nm,this.lambda_s=1500*t.nm,this.lambda_i=1600*t.nm,this.Type=["o -> o + o","e -> o + o","e -> e + o","e -> o + e"],this.theta=19.8371104525*Math.PI/180,this.phi=0,this.theta_s=0,this.theta_i=0,this.phi_s=0,this.phi_i=0,this.poling_period=1e6,this.L=2e4*t.um,this.W=500*t.um,this.p_bw=1,this.phase=!1,this.apodization=1,this.apodization_FWHM=1e3*t.um,this.xtal=new e.BBO}},e.SPDCprop=t}(),e.calcJSA=function(t,n,r,a,o,i){var s,c=new Float64Array(i),u=new Float64Array(i);c=e.linspace(n,r,i),u=e.linspace(o,a,i);var l=new Float64Array(i*i),h=i*i;for(new Date,s=0;h>s;s++){var p=s%i,f=Math.floor(s/i);l[s]=e.phasematch_Int_Phase(t.xtal,t.Type[1],t.lambda_p,t.p_bw,t.W,c[p],u[f],t.L,t.theta,t.phi,t.theta_s,t.theta_i,t.phi_s,t.phi_i,t.poling_period,t.phase,t.apodization,t.apodization_FWHM)}return new Date,l},e.linspace=function(t,e,n){for(var r=(e-t)/n,a=new Float64Array(n),o=0;n>o;o++)a[o]=t+r*o;return a},e});